(function(t,c){if(typeof c!=="function")return;function e(){var t=null;if(window.braze!==undefined){t=window.braze}else if(window.appboy!==undefined){t=window.appboy}return t}function r(){const t=new URL([...document.getElementsByTagName("script")].map(t=>t.src).find(t=>t.includes("braze-cart-script")));const e=new URLSearchParams(t.search);return Object.fromEntries(e.entries())}function a(t){var e=t+"=";var n=document.cookie.split(";");for(var o=0;o<n.length;o++){var c=n[o];while(c.charAt(0)==" ")c=c.substring(1,c.length);if(c.indexOf(e)==0)return c.substring(e.length,c.length)}return null}t.fetch=async function(){const t=await c.apply(this,arguments);try{if(arguments[0]=="/cart.js"){t.clone().json().then(t=>{if(t["item_count"]>0){const n=t["token"];const o=localStorage.getItem("cart_token");e().getDeviceId(function(t){if(n!=null&&n!=o){localStorage.setItem("cart_token",n);const e=r();c("https://"+e["sdk_url"]+`/api/v3/shopify/cart_update?cart_token=${n}&device_id=${t}&api_key=${e["api_key"]}&shop=${e["shop"]}`,{method:"POST"})}})}})}else if(arguments[0]=="/cart/add"||arguments[0]=="/cart/add.js"){const n=a("cart");const o=localStorage.getItem("cart_token");e().getDeviceId(function(t){if(n!=null&&n!=o){localStorage.setItem("cart_token",n);const e=r();c("https://"+e["sdk_url"]+`/api/v3/shopify/cart_update?cart_token=${n}&device_id=${t}&api_key=${e["api_key"]}&shop=${e["shop"]}`,{method:"POST"})}})}}catch(t){console.log("Encountered error: "+t+" trying to get cart token.")}finally{return t}}})(window,window.fetch);
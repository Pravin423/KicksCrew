(function(){function e(){var e=null;if(window.braze!==undefined){e=window.braze}else if(window.appboy!==undefined){e=window.appboy}return e}const l="reconciledCheckouts";var s=null;const o=JSON.parse(localStorage.getItem("__ui"));if(o!=null&&typeof o=="object"&&o.length>2){if(o[2]!=null&&typeof o[2]=="object"&&typeof o[2][0]=="object"){s=o[2][0]["checkoutSessionIdentifier"]}}if(s==null){return}e().getDeviceId(function(e){var o=e;if(o==null){console.warn(`Cannot reconcile checkout ${s} because Braze device ID cannot be obtained`)}else{const c=JSON.parse(localStorage.getItem(l)||"{}");const t=c[s]||null;if(t==o){return}else{c[s]=o;localStorage.setItem(l,JSON.stringify(c))}const n=new URL([...document.getElementsByTagName("script")].map(e=>e.src).find(e=>e.includes("braze-checkout-script")));const i=new URLSearchParams(n.search);const r=Object.fromEntries(i.entries());fetch("https://"+r["sdk_url"]+`/api/v3/shopify/checkout_user_reconcile?checkout_token=${s}&device_id=${o}&api_key=${r["api_key"]}&shop=${r["shop"]}`,{method:"POST"}).then(e=>{console.log(`Successfully reconciled checkout token ${s} with device ID ${o}`)}).catch(e=>{console.error(`Failed to reconcile checkout token ${s} with device ID ${o} due to error [${e}]`)})}})})();